include:
  - local: pipelines/templates/bases.yml

pr2:run-tests:
  image: python:$PYTHON_VERSION
  extends:
    - .base
    - .base-python
  script:
    - export PYTHONPATH="$PWD"
    - pytest $TEST_PATH

notify_on_fail_testing:
  allow_failure: true
  needs:
    - pr2:run-tests
  script:
    - >
      curl 
      -X POST 
      -H "Content-Type: application/json" 
      -d "{\"parse_mode\": \"HTML\",
      \"chat_id\": \"$TG_CHAT_ID\", 
      \"text\": \"üî¥–¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏
      \n–ü—Ä–æ–µ–∫—Ç <b>$CI_PROJECT_NAME</b> 
      \n–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä <b>$GITLAB_USER_NAME</b>
      \n–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ <b>$CI_COMMIT_TITLE</b>
      \n–•–µ—à –∫–æ–º–º–∏—Ç–∞ <b>$CI_COMMIT_SHA</b>\"}" 
      https://api.telegram.org/bot$TG_BOT_TOKEN/sendMessage
  when: on_failure